services:
  traefik:
    restart: "no"
    profiles:
      - donostart
    command: echo "Default GeoNature Traefik service disabled"

  redis:
    container_name: geonature-redis
    networks:
      - default

  postgres:
    container_name: geonature-postgres
    ports:
      - "127.0.0.1:${POSTGRES_HOST_PORT}:5432"
    networks:
      - default
    volumes:
      # Add data directory to use with COPY FROM
      - ${GENTIANA_DATA_PATH}:/app/geonature/data/raw/

  taxhub:
    container_name: geonature-taxhub
    networks:
      - default
      - traefik
    labels:
      - "traefik.docker.network=traefik"
      - "traefik.http.routers.taxhub.entrypoints=web,websecure"
      - "traefik.http.routers.taxhub.middlewares=hardening@docker"
      - "traefik.http.routers.taxhub.tls.certresolver=myresolver"

  usershub:
    container_name: geonature-usershub
    networks:
      - default
      - traefik
    labels:
      - "traefik.docker.network=traefik"
      - "traefik.http.routers.usershub.entrypoints=web,websecure"
      - "traefik.http.routers.usershub.middlewares=hardening@docker"
      - "traefik.http.routers.usershub.tls.certresolver=myresolver"

  geonature-backend:
    container_name: geonature-backend
    networks:
      - default
      - traefik
    labels:
      - "traefik.docker.network=traefik"
      - "traefik.http.routers.geonature-backend.entrypoints=web,websecure"
      - "traefik.http.routers.geonature-backend.middlewares=hardening@docker"
      - "traefik.http.routers.geonature-backend.tls.certresolver=myresolver"

  geonature-frontend:
    container_name: geonature-frontend
    networks:
      - default
      - traefik
    labels:
      - "traefik.docker.network=traefik"
      - "traefik.http.routers.geonature.entrypoints=web,websecure"
      - "traefik.http.routers.geonature.middlewares=hardening@docker"
      - "traefik.http.routers.geonature.tls.certresolver=myresolver"

  geonature-install-db:
    container_name: geonature-install-db
    networks:
      - default

  geonature-worker:
    container_name: geonature-worker
    networks:
      - default

networks:
  traefik:
    external: true